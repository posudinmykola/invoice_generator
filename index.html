<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Pro Mobile-First</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <style>
        [v-cloak] { display: none; }
        .modal-overlay { background: rgba(0,0,0,0.6); backdrop-filter: blur(2px); }
        /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é */
        .tab-button { transition: all 0.2s ease; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-900">
    <div id="app" v-cloak class="max-w-5xl mx-auto pb-20">
        
        <!-- HEADER (Sticky on mobile) -->
        <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-slate-200 p-4 md:p-6 mb-4 md:mb-8">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h1 class="text-2xl font-black tracking-tighter text-slate-800">DOCUMENT<span class="text-blue-600">HUB</span></h1>
                </div>
                <nav class="flex bg-slate-100 rounded-xl p-1 overflow-x-auto no-scrollbar">
                    <button v-for="(label, key) in tabs" @click="tab = key" 
                            :class="tab === key ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'"
                            class="tab-button px-4 py-2 rounded-lg text-xs md:text-sm font-bold whitespace-nowrap flex-1 text-center">
                        {{ label }}
                    </button>
                </nav>
            </div>
        </header>

        <div class="px-4 md:px-6">
            <!-- –¢–ê–ë: –ù–û–í–ê –ù–ê–ö–õ–ê–î–ù–ê -->
            <div v-if="tab === 'invoice'" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <div class="lg:col-span-2 space-y-4">
                    <!-- –°–ï–ö–¶–ò–Ø –¢–û–í–ê–†–û–í (–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è) -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                            <h2 class="font-bold text-slate-700">–°–∫–ª–∞–¥ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
                            <button @click="addItemRow" class="bg-blue-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold active:scale-95 transition-transform">
                                + –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä
                            </button>
                        </div>

                        <!-- –î–ï–°–ö–¢–û–ü–ù–´–ô –í–ò–î (–¢–∞–±–ª–∏—Ü–∞) -->
                        <div class="hidden md:block overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-slate-50 text-slate-500 border-b">
                                    <tr>
                                        <th class="p-4 text-left font-semibold">–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É</th>
                                        <th class="p-4 text-center font-semibold w-24">–ö-—Å—Ç—å</th>
                                        <th class="p-4 text-right font-semibold w-32">–¶—ñ–Ω–∞</th>
                                        <th class="p-4 text-right font-semibold w-32">–°—É–º–∞</th>
                                        <th class="p-4 w-10"></th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100">
                                    <tr v-for="(item, idx) in invoice.items" :key="idx">
                                        <td class="p-3">
                                            <select v-model="item.productId" @change="updateItemRow(idx)" class="w-full border-none focus:ring-0 font-medium text-slate-700">
                                                <option value="">-- –û–±–µ—Ä—ñ—Ç—å –∑—ñ —Å–ø–∏—Å–∫—É --</option>
                                                <option v-for="p in products" :value="p.id">{{p.name}}</option>
                                            </select>
                                        </td>
                                        <td class="p-3"><input type="number" v-model.number="item.qty" class="w-full text-center bg-slate-50 rounded-lg p-2 border-none focus:ring-1 focus:ring-blue-500"></td>
                                        <td class="p-3"><input type="number" v-model.number="item.price" class="w-full text-right bg-slate-50 rounded-lg p-2 border-none focus:ring-1 focus:ring-blue-500"></td>
                                        <td class="p-3 text-right font-bold text-slate-800">{{ (item.qty * item.price).toFixed(2) }}</td>
                                        <td class="p-3 text-center">
                                            <button @click="invoice.items.splice(idx,1)" class="text-slate-300 hover:text-red-500 text-xl">√ó</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- –ú–û–ë–ò–õ–¨–ù–´–ô –í–ò–î (–ö–∞—Ä—Ç–æ—á–∫–∏) -->
                        <div class="md:hidden divide-y divide-slate-100">
                            <div v-for="(item, idx) in invoice.items" :key="idx" class="p-4 space-y-3 relative">
                                <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª–∫–∏ -->
                                <button @click="invoice.items.splice(idx,1)" class="absolute top-2 right-2 w-8 h-8 flex items-center justify-center text-slate-300 bg-slate-50 rounded-full">√ó</button>
                                
                                <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É -->
                                <div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">–¢–æ–≤–∞—Ä</label>
                                    <select v-model="item.productId" @change="updateItemRow(idx)" class="w-full mt-1 border border-slate-200 rounded-xl p-3 text-sm font-bold bg-white focus:ring-2 focus:ring-blue-500 appearance-none">
                                        <option value="">-- –û–±–µ—Ä—ñ—Ç—å —Ç–æ–≤–∞—Ä --</option>
                                        <option v-for="p in products" :value="p.id">{{p.name}}</option>
                                    </select>
                                </div>

                                <!-- –†—è–¥: –ö–æ–ª-–≤–æ –∏ –¶–µ–Ω–∞ -->
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="text-[10px] font-bold text-slate-400 uppercase">–ö-—Å—Ç—å</label>
                                        <input type="number" v-model.number="item.qty" class="w-full mt-1 border border-slate-200 rounded-xl p-3 text-sm text-center font-bold">
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-bold text-slate-400 uppercase">–¶—ñ–Ω–∞ (–≥—Ä–Ω)</label>
                                        <input type="number" v-model.number="item.price" class="w-full mt-1 border border-slate-200 rounded-xl p-3 text-sm text-right font-bold">
                                    </div>
                                </div>

                                <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ -->
                                <div class="flex justify-between items-center pt-2 border-t border-dashed border-slate-100">
                                    <span class="text-xs text-slate-400 italic">–†–∞–∑–æ–º –ø–æ –ø–æ–∑–∏—Ü—ñ—ó:</span>
                                    <span class="text-base font-black text-blue-600">{{ (item.qty * item.price).toFixed(2) }} –≥—Ä–Ω</span>
                                </div>
                            </div>
                        </div>

                        <div v-if="invoice.items.length === 0" class="p-12 text-center">
                            <div class="text-4xl mb-2 text-slate-200">üì¶</div>
                            <div class="text-slate-400 text-sm italic">–°–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π —Ç–æ–≤–∞—Ä.</div>
                        </div>
                    </div>
                </div>

                <!-- –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ -->
                <div class="space-y-4">
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase">‚Ññ –î–æ–∫—É–º–µ–Ω—Ç–∞</label>
                                <input type="number" v-model.number="invoice.number" class="w-full border-slate-200 border rounded-xl p-3 mt-1 font-black text-blue-600 bg-slate-50">
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase">–î–∞—Ç–∞</label>
                                <input type="date" v-model="invoice.date" class="w-full border-slate-200 border rounded-xl p-3 mt-1 text-sm bg-slate-50">
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase">–ö–ª—ñ—î–Ω—Ç (–û–¥–µ—Ä–∂—É–≤–∞—á)</label>
                                <select v-model="selectedClientId" @change="loadClient" class="w-full border-slate-200 border rounded-xl p-3 mt-1 text-sm font-bold bg-white">
                                    <option value="">-- –ù–æ–≤–∏–π / –í—Ä—É—á–Ω—É --</option>
                                    <option v-for="c in clients" :key="c.id" :value="c.id">{{c.name}}</option>
                                </select>
                            </div>
                            <input v-model="invoice.client.name" placeholder="–ù–∞–∑–≤–∞ –∞–±–æ –ü–Ü–ë *" class="w-full border-slate-200 border rounded-xl p-3 text-sm">
                            <textarea v-model="invoice.client.address" placeholder="–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏" class="w-full border-slate-200 border rounded-xl p-3 text-sm h-16"></textarea>
                            <input v-model="invoice.client.edrpou" placeholder="–Ñ–î–†–ü–û–£ / –Ü–ü–ù" class="w-full border-slate-200 border rounded-xl p-3 text-sm">
                            <input v-model="invoice.client.phoneNumber" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É" class="w-full border-slate-200 border rounded-xl p-3 text-sm">
                            <input v-model="invoice.client.email" placeholder="–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞" class="w-full border-slate-200 border rounded-xl p-3 text-sm">
                            <input v-model="invoice.client.iban" placeholder="–ë–∞–Ω–∫—ñ–≤—Å—å–∫—ñ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏" class="w-full border-slate-200 border rounded-xl p-3 text-sm">
                            <input v-model="invoice.client.bankName" placeholder="–ù–∞–∑–≤–∞ –±–∞–Ω–∫—É" class="w-full border-slate-200 border rounded-xl p-3 text-sm">
                        </div>

                        <div class="mt-6 pt-6 border-t border-slate-100 text-right">
                            <div class="text-[10px] font-black text-slate-400 uppercase mb-1">–†–∞–∑–æ–º –¥–æ —Å–ø–ª–∞—Ç–∏</div>
                            <div class="text-4xl font-black text-slate-800 tracking-tighter">{{ totalSum.toFixed(2) }} <span class="text-sm font-normal text-slate-400 uppercase">–≥—Ä–Ω</span></div>
                            <button @click="generatePDF" :disabled="!invoice.client.name || invoice.items.length === 0" 
                                    class="w-full mt-6 bg-blue-600 disabled:bg-slate-200 text-white py-4 rounded-2xl font-black shadow-xl shadow-blue-100 active:scale-95 transition-all">
                                –ó–ì–ï–ù–ï–†–£–í–ê–¢–ò PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –î–†–£–ì–ò–ï –¢–ê–ë–´ (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ª–æ–≥–∏–∫–∏, –Ω–æ —Å –ª–µ–≥–∫–∏–º —Ä–µ—Å—Ç–∞–π–ª–∏–Ω–≥–æ–º) -->
            <!-- –¢–ê–ë: –¢–û–í–ê–†–ò -->
            <div v-if="tab === 'products'" class="bg-white p-4 md:p-8 rounded-2xl shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">–õ–∏—Å—Ç –ø–æ–∑–∏—Ü—ñ–π</h2>
                    <button @click="openProductModal()" class="bg-blue-600 text-white px-5 py-2 rounded-xl text-sm font-bold shadow-lg shadow-blue-50">+ –î–æ–¥–∞—Ç–∏</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div v-for="p in products" :key="p.id" class="p-4 border border-slate-100 rounded-xl flex justify-between items-center bg-white shadow-sm hover:border-blue-200">
                        <div class="pr-4">
                            <div class="font-bold text-slate-700 leading-tight">{{p.name}}</div>
                            <div class="text-blue-600 font-black text-sm mt-1">{{p.price}} <span class="text-[10px] text-slate-400 font-normal uppercase">–≥—Ä–Ω / {{p.unit}}</span></div>
                        </div>
                        <div class="flex gap-1">
                            <button @click="openProductModal(p)" class="p-2 text-slate-400 hover:text-blue-600">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                            </button>
                            <button @click="removeProduct(p.id)" class="p-2 text-slate-300 hover:text-red-500">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –¢–ê–ë: –ö–õ–Ü–Ñ–ù–¢–ò -->
            <div v-if="tab === 'clients'" class="bg-white p-4 md:p-8 rounded-2xl shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">–ë–∞–∑–∞ –∫–ª—ñ—î–Ω—Ç—ñ–≤</h2>
                    <button @click="openClientModal()" class="bg-blue-600 text-white px-5 py-2 rounded-xl text-sm font-bold shadow-lg shadow-blue-50">+ –î–æ–¥–∞—Ç–∏</button>
                </div>
                <div class="grid grid-cols-1 gap-3">
                    <div v-for="c in clients" :key="c.id" class="p-4 border border-slate-100 rounded-xl flex flex-col md:flex-row justify-between md:items-center bg-white shadow-sm gap-4">
                        <div class="flex-1">
                            <div class="font-black text-slate-800">{{c.name}}</div>
                            <div class="text-xs text-slate-500 mt-1 italic">{{c.address}}</div>
                            <div class="mt-2 text-[10px] font-bold text-blue-500 bg-blue-50 px-2 py-0.5 rounded inline-block uppercase">–Ñ–î–†–ü–û–£: {{c.edrpou}}</div>
                            <div class="mt-2 text-[10px] font-bold text-blue-500 bg-blue-50 px-2 py-0.5 rounded inline-block uppercase">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: {{c.phoneNumber}}</div>
                            <div class="mt-2 text-[10px] font-bold text-blue-500 bg-blue-50 px-2 py-0.5 rounded inline-block uppercase">–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞: {{c.email}}</div>
                            <div class="mt-2 text-[10px] font-bold text-blue-500 bg-blue-50 px-2 py-0.5 rounded inline-block uppercase">–ë–∞–Ω–∫—ñ–≤—Å—å–∫—ñ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏: {{c.iban}}</div>
                            <div class="mt-2 text-[10px] font-bold text-blue-500 bg-blue-50 px-2 py-0.5 rounded inline-block uppercase">–ù–∞–∑–≤–∞ –±–∞–Ω–∫—É: {{c.bankName}}</div>
                        </div>
                        <div class="flex gap-4 border-t md:border-t-0 pt-3 md:pt-0">
                            <button @click="openClientModal(c)" class="text-xs font-bold text-slate-400 hover:text-blue-600 uppercase tracking-widest">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                            <button @click="removeClient(c.id)" class="text-xs font-bold text-slate-400 hover:text-red-500 uppercase tracking-widest">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –¢–ê–ë: –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø -->
            <div v-if="tab === 'settings'" class="max-w-xl mx-auto space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold mb-4">–í–∞—à—ñ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏ (–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫)</h2>
                    <div class="space-y-4">
                        <input v-model="settings.vendorName" placeholder="–§–û–ü –ù–∞–∑–≤–∞" class="w-full border-slate-200 border rounded-xl p-3 text-sm">
                        <textarea v-model="settings.vendorAddress" placeholder="–Æ—Ä–∏–¥–∏—á–Ω–∞ –∞–¥—Ä–µ—Å–∞" class="w-full border-slate-200 border rounded-xl p-3 text-sm h-20"></textarea>
                        <input v-model="settings.vendorEdrpou" placeholder="–Ñ–î–†–ü–û–£" class="w-full border-slate-200 border rounded-xl p-3 text-sm">
                        <input v-model="settings.phoneNumber" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É" class="w-full border-slate-200 border rounded-xl p-3 text-sm">
                        <input v-model="settings.email" placeholder="–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞" class="w-full border-slate-200 border rounded-xl p-3 text-sm">
                        
                         <!-- <div class="grid grid-cols-2 gap-3">
                           <input v-model.number="settings.lastInvoiceNumber" placeholder="–û—Å—Ç–∞–Ω–Ω—ñ–π ‚Ññ" class="border-slate-200 border rounded-xl p-3 text-sm font-bold text-blue-600"> 
                        </div>-->
                        <input v-model="settings.vendorIban" placeholder="IBAN —Ç–∞ –±–∞–Ω–∫" class="w-full border-slate-200 border rounded-xl p-3 text-sm">
                        <button @click="saveData(true)" class="w-full bg-slate-900 text-white py-3 rounded-xl font-bold text-sm">–ó–±–µ—Ä–µ–≥—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
                    </div>
                </div>

                <div class="bg-slate-900 p-6 rounded-2xl text-white shadow-xl">
                    <h3 class="font-bold mb-2">–•–º–∞—Ä–Ω–∞ –∫–æ–ø—ñ—è (JSON)</h3>
                    <p class="text-slate-400 text-[10px] mb-6 uppercase tracking-widest">–û–Ω–æ–≤–ª–µ–Ω–æ: {{ new Date(updatedAt).toLocaleString() }}</p>
                    <div class="grid grid-cols-2 gap-3">
                        <button @click="exportJSON" class="bg-white/10 hover:bg-white/20 p-3 rounded-xl text-xs font-bold transition-all">–°–∫–∞—á–∞—Ç–∏ —Ñ–∞–π–ª</button>
                        <label class="bg-blue-600 hover:bg-blue-500 p-3 rounded-xl text-xs font-bold cursor-pointer text-center">
                            –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏
                            <input type="file" @change="importJSON" class="hidden" accept=".json">
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–û–î–ê–õ–ö–ò (–û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–ª—è –≤—Å–µ—Ö) -->
        <div v-if="modals.product || modals.client" class="fixed inset-0 z-50 modal-overlay flex items-end md:items-center justify-center p-0 md:p-4">
            <div class="bg-white rounded-t-3xl md:rounded-3xl p-6 md:p-8 w-full max-w-md shadow-2xl animate-slide-up">
                <div v-if="modals.product">
                    <h3 class="text-lg font-bold mb-4">{{ currentItem.id ? '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä' : '–ù–æ–≤–∏–π —Ç–æ–≤–∞—Ä' }}</h3>
                    <input v-model="currentItem.name" placeholder="–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É" class="w-full border p-3 rounded-xl mb-3 text-sm">
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <input v-model.number="currentItem.price" placeholder="–¶—ñ–Ω–∞" class="border p-3 rounded-xl text-sm">
                        <input v-model="currentItem.unit" placeholder="–û–¥. –≤–∏–º (—à—Ç)" class="border p-3 rounded-xl text-sm">
                    </div>
                    <div class="flex gap-3">
                        <button @click="modals.product = false" class="flex-1 py-3 font-bold text-slate-400">–ó–∞–∫—Ä–∏—Ç–∏</button>
                        <button @click="saveProduct" class="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                    </div>
                </div>
                <div v-if="modals.client">
                    <h3 class="text-lg font-bold mb-4">{{ currentItem.id ? '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞' : '–ù–æ–≤–∏–π –∫–ª—ñ—î–Ω—Ç' }}</h3>
                    <input v-model="currentItem.name" placeholder="–ù–∞–∑–≤–∞ –û–¥–µ—Ä–∂—É–≤–∞—á–∞" class="w-full border p-3 rounded-xl mb-3 text-sm font-bold">
                    <textarea v-model="currentItem.address" placeholder="–ê–¥—Ä–µ—Å–∞" class="w-full border p-3 rounded-xl mb-6 h-24 text-sm"></textarea>
                    <input v-model="currentItem.edrpou" placeholder="–Ñ–î–†–ü–û–£" class="w-full border p-3 rounded-xl mb-3 text-sm">
                    <input v-model="currentItem.phoneNumber" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É" class="w-full border p-3 rounded-xl mb-3 text-sm">
                    <input v-model="currentItem.email" placeholder="–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞" class="w-full border p-3 rounded-xl mb-3 text-sm">
                    <input v-model="currentItem.iban" placeholder="–ë–∞–Ω–∫—ñ–≤—Å—å–∫—ñ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏" class="w-full border p-3 rounded-xl mb-3 text-sm">
                    <input v-model="currentItem.bankName" placeholder="–ù–∞–∑–≤–∞ –±–∞–Ω–∫—É" class="w-full border p-3 rounded-xl mb-3 text-sm">
                    <div class="flex gap-3">
                        <button @click="modals.client = false" class="flex-1 py-3 font-bold text-slate-400">–ó–∞–∫—Ä–∏—Ç–∏</button>
                        <button @click="saveClient" class="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    tab: 'invoice',
                    tabs: { invoice: 'üßæ –ù–∞–∫–ª–∞–¥–Ω–∞', products: 'üì¶ –¢–æ–≤–∞—Ä–∏', clients: 'üë• –ö–ª—ñ—î–Ω—Ç–∏', settings: '‚öôÔ∏è –û–ø—Ü—ñ—ó' },
                    updatedAt: Date.now(),
                    modals: { product: false, client: false },
                    currentItem: {},
                    selectedClientId: '',
                    settings: {
                        vendorName: '–§–û–ü –ë–æ—Ä–æ–¥—ñ–Ω–∞ –ê—Ä—Å–µ–Ω—ñ—è –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞',
                        vendorAddress: '–£–∫—Ä–∞—ó–Ω–∞, 49000, –î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞ –æ–±–ª., –º. –î–Ω—ñ–ø—Ä–æ, –≤—É–ª. –°—ñ—á–µ—Å–ª–∞–≤—Å—å–∫–∞ –ù–∞–±–µ—Ä–µ–∂–Ω–∞, –±—É–¥. 49–∞, –∫–≤.31',
                        vendorEdrpou: '3624103363',
                        phoneNumber: '+380676327510',
                        email: 'arseniiaborodina@gmail.com',
                        vendorIban: 'UA443220010000026009360041169',
                        lastInvoiceNumber: 0
                    },
                    products: [],
                    clients: [],
                    invoice: {
                        number: 1,
                        date: new Date().toISOString().substr(0, 10),
                        client: { name: '', address: '', edrpou: '', phoneNumber: '', email:'', iban:'',bankName:''   },
                        items: []
                    }
                }
            },
            computed: {
                totalSum() {
                    return this.invoice.items.reduce((sum, item) => sum + (item.qty * item.price), 0);
                }
            },
            methods: {
                saveData(showAlert = false) {
                    this.updatedAt = Date.now();
                    const db = { settings: this.settings, products: this.products, clients: this.clients, updatedAt: this.updatedAt };
                    localStorage.setItem('invoice_pro_db_v3', JSON.stringify(db));
                    if(showAlert) alert('–ó–±–µ—Ä–µ–∂–µ–Ω–æ!');
                },
                openProductModal(item = null) {
                    this.currentItem = item ? { ...item } : { name: '', price: 0, unit: '—à—Ç' };
                    this.modals.product = true;
                },
                saveProduct() {
                    if (this.currentItem.id) {
                        const idx = this.products.findIndex(p => p.id === this.currentItem.id);
                        this.products[idx] = this.currentItem;
                    } else {
                        this.currentItem.id = Date.now();
                        this.products.push(this.currentItem);
                    }
                    this.saveData();
                    this.modals.product = false;
                },
                removeProduct(id) {
                    if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')) { this.products = this.products.filter(p => p.id !== id); this.saveData(); }
                },
                openClientModal(item = null) {
                    this.currentItem = item ? { ...item } : { name: '', address: '', edrpou: '', phoneNumber: '', email:'', iban:'', bankName:'' };
                    this.modals.client = true;
                },
                saveClient() {
                    if (this.currentItem.id) {
                        const idx = this.clients.findIndex(c => c.id === this.currentItem.id);
                        this.clients[idx] = this.currentItem;
                    } else {
                        this.currentItem.id = Date.now();
                        this.clients.push(this.currentItem);
                    }
                    this.saveData();
                    this.modals.client = false;
                },
                removeClient(id) {
                    if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')) { this.clients = this.clients.filter(c => c.id !== id); this.saveData(); }
                },
                addItemRow() {
                    this.invoice.items.push({ productId: '', name: '', qty: 1, price: 0, unit: '—à—Ç' });
                },
                updateItemRow(idx) {
                    const prod = this.products.find(p => p.id === this.invoice.items[idx].productId);
                    if (prod) {
                        this.invoice.items[idx].name = prod.name;
                        this.invoice.items[idx].price = prod.price;
                        this.invoice.items[idx].unit = prod.unit;
                    }
                },
                loadClient() {
                    const client = this.clients.find(c => c.id === this.selectedClientId);
                    this.invoice.client = client ? { ...client } : {  name: '', address: '', edrpou: '', phoneNumber: '', email:'', iban:'',bankName:'' };
                },
                generatePDF() {
                    if (this.invoice.client.name && !this.selectedClientId) {
                        const newId = Date.now();
                        this.clients.push({ ...this.invoice.client, id: newId });
                        this.selectedClientId = newId;
                    }
                    const dd = {
                        content: [
                            { text: `–í–∏–¥–∞—Ç–∫–æ–≤–∞ –Ω–∞–∫–ª–∞–¥–Ω–∞ ‚Ññ ${this.invoice.number} –≤—ñ–¥ ${this.invoice.date}—Ä.`, style: 'header', alignment: 'center', margin: [0,0,0,20] },
                            { text: '–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫:', bold: true, fontSize: 10 },
                            { text: `${this.settings.vendorName}\n–ê–¥—Ä–µ—Å–∞: ${this.settings.vendorAddress}\n–Ñ–î–†–ü–û–£: ${this.settings.vendorEdrpou}\n–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: ${this.settings.phoneNumber}\n–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞: ${this.settings.email}\n–ë–∞–Ω–∫—ñ–≤—Å—å–∫—ñ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏: ${this.settings.vendorIban}\n\n`, fontSize: 9 },
                            { text: '–û–¥–µ—Ä–∂—É–≤–∞—á:', bold: true, fontSize: 10 },
                            { text: `${this.invoice.client.name}\n–ê–¥—Ä–µ—Å–∞: ${this.invoice.client.address}\n–Ñ–î–†–ü–û–£: ${this.invoice.client.edrpou}\n–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: ${this.invoice.client.phoneNumber}\n–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞: ${this.invoice.client.email}\n–ë–∞–Ω–∫—ñ–≤—Å—å–∫—ñ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏: ${this.invoice.client.iban}\n–ù–∞–∑–≤–∞ –±–∞–Ω–∫—É: ${this.invoice.client.bankName}\n\n`, fontSize: 9 },
                            {
                                table: {
                                    headerRows: 1,
                                    widths: [20, '*', 35, 35, 60, 65],
                                    body: [
                                        [{text:'‚Ññ', style:'tH'}, {text:'–¢–æ–≤–∞—Ä', style:'tH'}, {text:'–ö-—Å—Ç—å', style:'tH'}, {text:'–û–¥.', style:'tH'}, {text:'–¶—ñ–Ω–∞', style:'tH'}, {text:'–°—É–º–∞', style:'tH'}],
                                        ...this.invoice.items.map((it, i) => [i+1, it.name, it.qty, it.unit || '—à—Ç', it.price.toFixed(2), (it.qty * it.price).toFixed(2)]),
                                        [{text: '–í—Å—å–æ–≥–æ –±–µ–∑ –ü–î–í', colSpan: 5, alignment: 'right', bold: true}, {}, {}, {}, {}, {text: this.totalSum.toFixed(2), bold: true, alignment: 'right'}]
                                    ]
                                }
                            },
                            { text: `\n–í—Å—å–æ–≥–æ –Ω–∞–π–º–µ–Ω—É–≤–∞–Ω—å ${this.invoice.items.length} –Ω–∞ —Å—É–º—É ${this.totalSum.toFixed(2)} –≥—Ä–Ω.`, margin: [0, 10, 0, 40] },
                            { columns: [{text: `–í—ñ–¥–ø—É—Å—Ç–∏–≤: ${this.settings.vendorName}`, fontSize: 10}, {text: `–û—Ç—Ä–∏–º–∞–≤: ${this.invoice.client.name}`, alignment: 'right', fontSize: 10}] }
                        ],
                        styles: { header: { fontSize: 16, bold: true }, tH: { bold: true, fillColor: '#f3f4f6', fontSize: 9 } },
                        defaultStyle: { fontSize: 9 }
                    };
                    pdfMake.createPdf(dd).download(`–ù–∞–∫–ª–∞–¥–Ω–∞_${this.invoice.number}.pdf`);
                    this.settings.lastInvoiceNumber = this.invoice.number;
                    this.saveData();
                    this.invoice.number++;
                },
                exportJSON() {
                    const blob = new Blob([localStorage.getItem('invoice_pro_db_v3')], { type: 'application/json' });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = `backup_v${this.updatedAt}.json`;
                    a.click();
                },
                importJSON(e) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        const inc = JSON.parse(ev.target.result);
                        if (inc.updatedAt > this.updatedAt) {
                            if (confirm('–§–∞–π–ª —Å–≤—ñ–∂—ñ—à–∏–π. –ó–∞–º—ñ–Ω–∏—Ç–∏ –±–∞–∑—É?')) {
                                Object.assign(this.$data, inc);
                                this.saveData();
                                location.reload();
                            }
                        } else { alert('–§–∞–π–ª —Å—Ç–∞—Ä—ñ—à–∏–π –∑–∞ –ø–æ—Ç–æ—á–Ω—É –±–∞–∑—É.'); }
                    };
                    reader.readAsText(e.target.files[0]);
                }
            },
            mounted() {
                const data = localStorage.getItem('invoice_pro_db_v3');
                if (data) {
                    const db = JSON.parse(data);
                    this.products = db.products || [];
                    this.clients = db.clients || [];
                    this.settings = db.settings || this.settings;
                    this.updatedAt = db.updatedAt || Date.now();
                    this.invoice.number = (this.settings.lastInvoiceNumber || 0) + 1;
                }
            }
        }).mount('#app');
    </script>
</body>
</html>